# Classification of mha images using saved model:
`version 1.0`  

**Classification procedure is divided into two subroutines:**
#### A: File preparation:
Patient data has to be properly restructured from `classify/raw` directory into "well known" data structure
in `classify/structured` folder. Implemented data translation algorithm allows transformation of generic BRATS15
testing data into proper structure. To achieve proper restructurization of different data, it had to follow 
inner folder structure described in [`classify/raw/readme.md`](../classify/raw/readme.md) file.  
This procedure generates list of directories named according to pattern *pat\_\<id\>* in `classify/structured`,
containing all 4 mha files associated with patient, conserving their original names.
#### B: Tumor classification:
Repeated for each patient in `classify/structured` directory
1. All four data files are loaded into memory as list of slices in all axes (3 lists), and paired with consecutive layer
number.
1. All slices are fed into automatic segmentation algorithm (as described in [`PrepareData.md`](PrepareData.md))
1. Masks generated by segmentation are divided into single stains and feed into classification procedure:
    1. stains are converted into 28x28 pixel entities
    1. entities are analyzed by classifier, and returned with two float values representing probability of
    such part being member of respectively ***tumor*** and ***not tumor*** group
1. Stains with positive (***tumor***) result are multiplied by probability value and reconstructed into slice,
***not tumor*** stains are simply discarded.
1. Consecutive slices representing single image divided according to one axis are gathered together to
reconstruct 3d image. After this step we would have 12 cuboids (4 images, by 3 axes per image), each
containing float values in range *\<0.0, 1.0\>* 
1. Next we summarize images for axes into single cuboid per image type. After this step we would have 4 cuboids,
each containing float values in range *\<0.0, 3.0\>* 
1. After that we summarize all cuboids to generate complete tumor map - cuboid with float values in range
*\<0.0, 12.0\>*. Higher the value of single *"pixel"* (array cell), the higher probability that tumor is in
this place
1. Finally resulting cuboid is normalized to contain only 0 or 1's. This task is performed by binearization
with cutoff level set to 3.0 (values less or equal \-\> 0, greater \-\> 1)
Such low value of offset is dictated by extremely low accuracy of current segmentation logic, for proper
segmentation algorithm this value should be greater than 6.0.